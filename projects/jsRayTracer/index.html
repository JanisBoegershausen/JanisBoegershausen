<head>
  <title>Raytracer</title>
  <link rel="stylesheet" href="../../main.css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <script language="javascript" type="text/javascript" src="../../SyntaxHighlighter.js"></script>
  <script language="javascript" type="text/javascript" src="Vector.js"></script>
  <script language="javascript" type="text/javascript" src="RayHitInfo.js"></script>
  <script language="javascript" type="text/javascript" src="Triangle.js"></script>
  <script language="javascript" type="text/javascript" src="EnviromentTexture.js"></script>
  <script language="javascript" type="text/javascript" src="RayTracer.js"></script>

  <script>
    // Run code stylizer once the code has loaded
    window.addEventListener("load", SyntaxHighlightElementsOnPage);
  </script>
</head>

<body>
  <headline style="color: white; cursor: pointer; text-align: left; font-size: 20px; height: 20px" onclick="window.open('https://janisboegershausen.github.io/');">Home</headline>
  <headline> Raytracer </headline>
  <textSection> A simple <coloredText style="color: tomato">(WIP)</coloredText> raytracer written in javascript. Press enter to start a new render. </textSection>
  <textSection>
    Canvas
    <br />
    <br />
    <div style="width: 500px; height: 500px; margin: auto" id="rayTracer-canvas"></div>
  </textSection>
  <textSection>
    Info
    <div style="font-size: 20px; margin-top: 10px">
      This is a simple raytracer written in JavaScript. You can check out the sourcecode
      <a href="https://github.com/JanisBoegershausen/JanisBoegershausen.github.io/tree/master/projects/jsRayTracer">HERE</a>.
      <br />
      More features will come soon. So far this only renders two triangles using Web-Workers. I plan to add shading and reflections soon.
    </div>
  </textSection>
  <textSection>
    Tiling & Web-Workers
    <div style="font-size: 20px; margin-top: 10px">
      Tiling describes splitting the image into multiple smaller rectangles and rendering them seperatly. This allows us to render the image using paralelism. Right now, the ammount of tiles is set to 4x4, so 16 tiles in total. <br />
      For each of these tiles, a webworker is created, that renders the dedicated section and sends it back to the main script.
    </div>
  </textSection>
  <textSection>
    Enviroment
    <div style="font-size: 20px; margin-top: 10px">
      Since I became a bit bored of the empty background behind the square, I implemented a skybox. <br />
      To achieve this, each ray that does not hit a triangle, samples an HDRI, which is loaded in advance <br />
      and the data is send to all of the workers. <br />
      <br />
      The sampling is done by converting the direction of a ray to UVs through calculating the around the y axis and the y component of the direction:
      <br />

      <code>var a = 1;</code>

      <div class="codeSection">
// Convert from radians to degrees
angleAlongY = angleAlongY * (180 / Math.PI);

// Make angle go from 0 to 360 clockwise instead of from 0 to 180 in both directions
if (direction.x < 0) {
	angleAlongY = angleAlongY * -1 + 360;
}

var textureCoordinate = { x: angleAlongY / 360, y: (direction.y + 1) / 2 };
var pixel = this.pixels[Math.floor(textureCoordinate.x * this.width)][Math.floor(textureCoordinate.y * this.height)];
      </div>
      <br />
      This is the used HDRI from
      <a href="https://polyhaven.com/hdris">Polyhaven</a>:
    </div>
    <img id="hdri" src="../../images/enviromentTexture_1.jpg" />
  </textSection>
</body>
